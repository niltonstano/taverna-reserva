# ğŸ· Taverna Reserva â€” API de E-commerce de Alta Performance

API de e-commerce desenvolvida com foco em **resiliÃªncia, consistÃªncia de dados e seguranÃ§a**, utilizando uma arquitetura escalÃ¡vel com **Fastify, MongoDB (Replica Set) e TypeScript**.

O projeto implementanda soluÃ§Ãµes para problemas reais de sistemas distribuÃ­dos, como **concorrÃªncia de estoque e idempotÃªncia de pagamentos**.

---

## ğŸš€ Diferenciais de Engenharia (O que torna este projeto Ãºnico)

Diferente de APIs comuns, este projeto implementa padrÃµes de sistemas de missÃ£o crÃ­tica:

### ğŸ›¡ï¸ ConsistÃªncia de Dados e TransaÃ§Ãµes ACID

Utiliza **MongoDB Replica Set** para garantir transaÃ§Ãµes atÃ´micas. No processo de checkout, a criaÃ§Ã£o do pedido, a baixa de estoque e a limpeza do carrinho ocorrem em uma Ãºnica transaÃ§Ã£o: **ou tudo acontece, ou nada Ã© alterado**.

### âš¡ ProteÃ§Ã£o contra CondiÃ§Ã£o de Corrida (Race Conditions)

O sistema de estoque foi validado com **testes de estresse simultÃ¢neos**. Se 10 usuÃ¡rios tentarem comprar o Ãºltimo item ao mesmo tempo, o sistema garante atravÃ©s de travas lÃ³gicas e transaÃ§Ãµes que apenas 1 consiga, mantendo a integridade do inventÃ¡rio.

### ğŸ”‘ IdempotÃªncia de OperaÃ§Ãµes

ImplementaÃ§Ã£o de **Idempotency Keys** em rotas crÃ­ticas (Checkout). Isso evita que uma falha de conexÃ£o ou um "duplo clique" do usuÃ¡rio resulte em duas cobranÃ§as ou dois pedidos idÃªnticos.

### ğŸ§ª SuÃ­te de Testes Profissional

- **Testes de IntegraÃ§Ã£o:** Validando o fluxo completo com banco de dados em memÃ³ria.
- **Testes de Estresse:** SimulaÃ§Ã£o de mÃºltiplas requisiÃ§Ãµes simultÃ¢neas para validar concorrÃªncia.
- **SeguranÃ§a (Anti-IDOR):** Testes especÃ­ficos que garantem que um usuÃ¡rio nÃ£o consiga acessar dados de terceiros.

---

## ğŸ› ï¸ Stack TecnolÃ³gica

| Tecnologia               | Finalidade                                                       |
| :----------------------- | :--------------------------------------------------------------- |
| **Node.js 24 + Fastify** | Runtime e Framework de alta performance (low overhead).          |
| **TypeScript**           | Desenvolvimento tipado e seguro.                                 |
| **MongoDB + Mongoose**   | Banco NoSQL com modelagem via Schemas e suporte a TransaÃ§Ãµes.    |
| **Zod**                  | ValidaÃ§Ã£o de esquema e contratos de dados (Type-safety runtime). |
| **JWT + Bcrypt**         | AutenticaÃ§Ã£o robusta e seguranÃ§a de credenciais.                 |
| **Melhor Envio API**     | IntegraÃ§Ã£o real para cotaÃ§Ã£o de frete e logÃ­stica.               |
| **Docker & Compose**     | OrquestraÃ§Ã£o de containers para API e Banco de Dados.            |

---

## ğŸ—ï¸ Arquitetura e PadrÃµes de Projeto

A aplicaÃ§Ã£o segue os princÃ­pios de **Clean Architecture** e **SOLID**:

- **Controllers:** Apenas manipulaÃ§Ã£o de entrada e saÃ­da (REQ/RES).
- **Services:** Toda a regra de negÃ³cio, isolada e testÃ¡vel.
- **Repositories:** AbstraÃ§Ã£o da camada de dados (Data Access Layer).
- **Middlewares/Hooks:** Saneamento de dados automÃ¡tico e logs estruturados com **Pino**.

---

## ğŸ“¦ Funcionalidades Principais

- **GestÃ£o de Produtos:** Controle de estoque rigoroso e catÃ¡logo dinÃ¢mico.
- **Checkout Inteligente:** IntegraÃ§Ã£o com **Melhor Envio** para cotaÃ§Ã£o de frete em tempo real baseada em dimensÃµes e peso.
- **RBAC (Role Based Access Control):** NÃ­veis de permissÃ£o distintos para `Admin` e `Customer`.
- **Logs Estruturados:** Monitoramento de saÃºde e erros da API em tempo real.

---

## ğŸ“Š Observabilidade e ResiliÃªncia (Logs e DiagnÃ³sticos)

O projeto utiliza o **Pino** para geraÃ§Ã£o de logs estruturados em JSON. Durante a execuÃ§Ã£o da suÃ­te de testes ou em produÃ§Ã£o, vocÃª poderÃ¡ observar logs de nÃ­vel `WARN (40)` ou `ERROR (50)`.

Ã‰ importante destacar que:

- **Erros Induzidos:** Grande parte desses logs sÃ£o comportamentos esperados e induzidos pelos testes de seguranÃ§a e estresse.
- **ValidaÃ§Ã£o de Bloqueio:** Logs de "Tentativa de acesso nÃ£o autorizado" ou "BLOQUEIO RBAC" confirmam que as camadas de proteÃ§Ã£o estÃ£o interceptando acessos indevidos com sucesso.
- **Controle de ConcorrÃªncia:** Logs de erro em operaÃ§Ãµes de checkout simultÃ¢neas sÃ£o evidÃªncias de que o mecanismo de idempotÃªncia travou uma requisiÃ§Ã£o duplicada para proteger a integridade financeira da operaÃ§Ã£o.

## "Em um sistema resiliente, um log de erro bem rastreado Ã© a prova de que uma falha foi prevista e contida."

## ğŸ”§ Como Executar

Clonar e Configurar:

Bash
git clone https://github.com/niltonstano/taverna-reserva.git
cd taverna-reserva
cp .env.example .env # NÃ£o esqueÃ§a de preencher as variÃ¡veis!

ğŸ› ï¸ Como Subir o Projeto
Siga os passos abaixo para replicar o ambiente de desenvolvimento localmente.

1. PrÃ©-requisitos
   Certifique-se de ter instalado em sua mÃ¡quina:

Docker

Docker Compose

2. ConfiguraÃ§Ã£o das VariÃ¡veis de Ambiente
   Crie um arquivo .env na raiz da pasta backend/ seguindo o modelo abaixo para garantir que o sistema de seed e a conexÃ£o com o banco funcionem corretamente:

Snippet de cÃ³digo

# Banco de Dados

MONGO_URI=mongodb://mongodb:27017/taverna?replicaSet=rs0&directConnection=true

# Credenciais Iniciais do Administrador (Seed)

INITIAL_ADMIN_EMAIL=admin@taverna.com
INITIAL_ADMIN_PASSWORD=SuaSenhaSeguraAqui
INITIAL_ADMIN_NAME=Admin Master

# SeguranÃ§a

JWT_SECRET=sua_chave_secreta_aqui 3. Subindo os Containers
No terminal, dentro da pasta raiz do projeto, execute:

```bash
docker compose up -d --build
Este comando irÃ¡ construir as imagens, configurar a rede e subir os serviÃ§os de API, Banco de Dados e o Frontend.

4. Populando o Banco (Seed)
   Para criar o usuÃ¡rio administrador e os vinhos base com estoque inicial, execute o script de sincronizaÃ§Ã£o segura:

docker compose exec api npx tsx src/scripts/seed-master.ts

  ğŸ›¡ï¸ Diferenciais do Projeto
Data Seed Seguro: O sistema de populaÃ§Ã£o de dados nÃ£o expÃµe credenciais no cÃ³digo fonte, utilizando variÃ¡veis de ambiente para gerenciar o acesso administrativo inicial.

Ambiente Isolado: Todo o ecossistema (Banco, API e Web) Ã© orquestrado via Docker, garantindo que o projeto rode exatamente da mesma forma em qualquer mÃ¡quina.

IntegraÃ§Ã£o de Estoque: Scripts preparados para reset de estoque e sincronizaÃ§Ã£o de produtos para testes de estresse e performance.

    Principais endpoints

API Docs (Swagger): http://localhost:3333/docs

Health Check: http://localhost:3333/api/v1/health

Frontend: http://localhost:8080

```

```

## Como executar os testes

npm run test:manual-stress
OBs:(Com IDs validos)

Para validar tudo: npm test

Para focar em seguranÃ§a/IDOR: npm run test:int

Para verificar o deploy final: npm run test:e2e

ğŸ‘¨â€ğŸ’» Autor
Nilton Alexandre Stano Desenvolvedor Backend com foco em arquiteturas resilientes e performance.

GitHub: https://github.com/niltonstano

```

```

```
