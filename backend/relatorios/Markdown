# ğŸ· Taverna Reserva â€” API de E-commerce de Alta Performance

API de e-commerce desenvolvida com foco em **resiliÃªncia, consistÃªncia de dados e seguranÃ§a**, utilizando uma arquitetura escalÃ¡vel com **Fastify, MongoDB (Replica Set) e TypeScript**.

O projeto implementa soluÃ§Ãµes para problemas reais de sistemas distribuÃ­dos, como **concorrÃªncia de estoque e idempotÃªncia de pagamentos**.

---

## ğŸš€ Diferenciais de Engenharia

Diferente de APIs comuns, este projeto implementa padrÃµes de sistemas de missÃ£o crÃ­tica:

### ğŸ›¡ï¸ ConsistÃªncia de Dados e TransaÃ§Ãµes ACID

Utiliza **MongoDB Replica Set** para garantir transaÃ§Ãµes atÃ´micas. No processo de checkout, a criaÃ§Ã£o do pedido, a baixa de estoque e a limpeza do carrinho ocorrem em uma Ãºnica transaÃ§Ã£o: **ou tudo acontece, ou nada Ã© alterado**.

### âš¡ ProteÃ§Ã£o contra CondiÃ§Ã£o de Corrida (Race Conditions)

O sistema de estoque foi validado com **testes de estresse simultÃ¢neos**. Se 10 usuÃ¡rios tentarem comprar o Ãºltimo item ao mesmo tempo, o sistema garante atravÃ©s de travas lÃ³gicas que apenas 1 consiga, mantendo a integridade do inventÃ¡rio.

### ğŸ”‘ IdempotÃªncia de OperaÃ§Ãµes

ImplementaÃ§Ã£o de **Idempotency Keys** em rotas crÃ­ticas. Isso evita que falhas de rede ou cliques duplos resultem em cobranÃ§as duplicadas ou pedidos repetidos.

---

## ğŸ› ï¸ Stack TecnolÃ³gica

| Tecnologia               | Finalidade                                               |
| :----------------------- | :------------------------------------------------------- |
| **Node.js 24 + Fastify** | Runtime e Framework de alta performance (low overhead).  |
| **TypeScript**           | Desenvolvimento tipado e seguro.                         |
| **MongoDB + Mongoose**   | Banco NoSQL com suporte a TransaÃ§Ãµes e Replica Set.      |
| **Zod**                  | ValidaÃ§Ã£o de esquema e contratos de dados (Type-safety). |
| **JWT + Bcrypt**         | AutenticaÃ§Ã£o robusta e seguranÃ§a de credenciais.         |
| **Docker & Compose**     | OrquestraÃ§Ã£o completa do ecossistema (API, DB, Web).     |

---

## ğŸ“¦ Funcionalidades Principais

- **GestÃ£o de Produtos:** Controle de estoque rigoroso e catÃ¡logo dinÃ¢mico.
- **Checkout Inteligente:** IntegraÃ§Ã£o real com **Melhor Envio** para cotaÃ§Ã£o de frete.
- **RBAC (Role Based Access Control):** NÃ­veis de permissÃ£o para `Admin` e `Customer`.
- **Logs Estruturados:** Monitoramento em tempo real com **Pino**.

---

ğŸ”§ Guia de InstalaÃ§Ã£o (RÃ¡pido)

1. PreparaÃ§Ã£o
   Bash
   git clone https://github.com/niltonstano/taverna-reserva.git
   cd taverna-reserva
   cp backend/.env.example backend/.env
2. ConfiguraÃ§Ã£o do Ambiente (backend/.env)
   Certifique-se de que a MONGO_URI estÃ¡ configurada para o ambiente Docker:

Snippet de cÃ³digo

# ConexÃ£o para o Replica Set no Docker

MONGO_URI=mongodb://mongodb:27017/taverna?replicaSet=rs0&directConnection=true

# Credenciais do Admin Inicial

INITIAL_ADMIN_EMAIL=admin@taverna.com
INITIAL_ADMIN_PASSWORD=SuaSenhaSegura
JWT_SECRET=sua_chave_secreta 3. Subir a Infraestrutura
Bash

# ConstrÃ³i e sobe os serviÃ§os (API, MongoDB, Frontend)

docker compose up -d --build

# Aguarde o banco ficar "healthy" (aprox. 10-15 segundos)

docker compose ps

# Cria o administrador master e o catÃ¡logo de produtos

docker compose exec api node dist/src/scripts/seed-master.js

```ğŸ“Š Acesso e DocumentaÃ§Ã£o
ğŸŒ Frontend: http://localhost:8080 (Interface de usuÃ¡rio)

ğŸ”Œ API Base: http://localhost:3333/api/v1

ğŸ“– Swagger UI: http://localhost:3333/docs (DocumentaÃ§Ã£o interativa)

ğŸ©º Health Check: http://localhost:3333/api/v1/health
```

```ğŸ§ª ResiliÃªncia na PrÃ¡tica
Para testar o comportamento do sistema sob estresse:

Teste de ConcorrÃªncia: npm run test:manual-stress (Simula 10 compras simultÃ¢neas do Ãºltimo item).

Teste de Unidade: npm test (Valida lÃ³gica de negÃ³cio e Error Handler).
```

```ğŸ›‘ Comandos de Utilidade
Cria e liga os containers: docker compose up -d

Ver Logs da API: docker compose logs -f api

Acompanhar o Seed: docker compose logs -f database-seed

Parar aplicaÃ§Ã£o: docker compose stop
(Use um terminal secundario)

Remover tudo (Reset): docker compose down -v
```

ğŸ‘¨â€ğŸ’» Autor
Nilton Alexandre Stano â€” Desenvolvedor Backend focado em arquiteturas resilientes.
(https://github.com/niltonstano/taverna-reserva.git)

âœ… Checklist para o Recrutador:
[ ] Subiu o Docker?

[ ] Rodou o seed-master.js?

[ ] Acessou o Swagger em /docs?

[ ] Viu os logs no terminal com docker compose logs -f api?

[ ] Testou o endpoint de health check?

[ ] Simulou o teste de concorrÃªncia?
